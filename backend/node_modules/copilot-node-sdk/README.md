# Copilot Node.JS SDK

The Copilot Node.JS SDK provides easy to call functions written in TypeScript for interacting with the Copilot REST API. Right now this is a TypeScript only package. In the future we will have a Vanilla JS package with a corresponding @types package to go along with it.

This SDK is intended to be used on the server-side only. We do not currently offer a package for client-side development.

## Setup

### For Custom Apps

```typescript
import { copilotApi } from 'copilot-node-sdk';

const copilot = copilotApi({ apiKey: YOUR_API_KEY_HERE });
```

### For Marketplace Apps

If you're building a Marketplace app you should go through one additional step of fetching a query parameter that gets passed into the App URL when rendered in the Copilot dashboard: `?token=TOKEN_IS_HERE`

Grab that token from the URL and pass it in to the copilotApi configuration object.

```typescript
import { copilotApi } from 'copilot-node-sdk';

const copilot = copilotApi({
  apiKey: YOUR_API_KEY_HERE,
  token: searchParams.token,
});
```

## How to develop this package internally:

1. `yarn`
2. `yarn generate-api`
3. `yarn test` to produce a successful response
4. `yarn test:fail` to product a response that fails because of a missing env variable.

For additional logging you can set the environment variable `COPILOT_DEBUG` to any truthy value. This is useful if you'd like to see SDK logs while developing in an application's codebase.

## Field Deprecations

### Deprecated Fields

The following fields are deprecated and will be removed in a future version of the SDK:

#### `companyId` (deprecated in v3.15.0)

- **Replacement**: Use `companyIds` array instead
- **Reason**: To support multi-company functionality
- **Removal**: Will be removed in v4.0.0
- **Affected endpoints**: Client operations, App connections, Tasks

#### `recipientId` (deprecated in v3.15.0)

- **Replacement**: Use `clientId` and `companyId` instead
- **Reason**: More explicit recipient targeting
- **Removal**: Will be removed in v4.0.0
- **Affected endpoints**: Contracts, Invoices, Notifications, Subscriptions

### Migration Guide

**Before (deprecated):**

```typescript
// Creating a client with single company
await copilot.createClient({
  companyId: 'company-uuid-here',
  // ... other fields
});

// Creating an invoice with recipient ID
await copilot.createInvoice({
  recipientId: 'recipient-uuid-here',
  // ... other fields
});
```

**After (recommended):**

```typescript
// Creating a client with multiple companies support
await copilot.createClient({
  companyIds: ['company-uuid-here'], // Now an array
  // ... other fields
});

// Creating an invoice with explicit client and company targeting
await copilot.createInvoice({
  clientId: 'client-uuid-here',
  companyId: 'company-uuid-here',
  // ... other fields
});
```

### Developer Experience

When using deprecated fields, you'll see:

- **IDE warnings**: TypeScript will show deprecation warnings in your editor
- **JSDoc annotations**: Hover over deprecated fields to see migration guidance
- **Continued functionality**: Deprecated fields continue to work until removal
